<html lang="en"><head><meta name="viewport" content="width=device-width, initial scale=1"/><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/><title>Click & Change Calendar</title><link rel="shortcut icon" href="favicon.png"/><link rel="stylesheet" href="css/bootstrap.css"/><link rel="stylesheet" href="css/calendar.css"/><!--link(rel='stylesheet',href='')--><script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script><script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script></head><body><div id="calendar"></div><div id="form"><form id="eventform"><div class="field"><label>id:</label><input id="eventId" type="text" name="id"/></div><div class="field"><label>title:</label><input id="eventTitle" type="text" name="title" placeholder="title"/></div><div class="field"><label>extra:</label><input id="eventExtra" type="text" name="extra" placeholder="extra"/></div><div class="field"><button onclick="closeForm()">Close</button><button type="submit" value="Send">Submit</button></div></form></div></body><script>function closeForm(){
  $("#form").css('display','none');
}  
//vars
daysLabels = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday','Sunday']; 
monthsLabels = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
var d = new Date();
//NIEUWE DATASTRUCTUUR MAKEN DAT xxxxxxx PARST,  dus alle dates omzetten naar 1 nieuwe datastructuur.

function parseDateToString(date){
  var years = date.getFullYear();
  var months = (date.getMonth()+1)
  if (months < 10)
    months = '0'+months
  var days = date.getDate();
  if (days < 10)
    days = '0'+days;
  var weekdays = '0'+date.getDay();

  return (years+''+months+''+days+''+weekdays)
}

var dayCounter = d.getDate(); 
if (dayCounter < 10)
  dayCounter = ''+dayCounter;
var monthCounter = (d.getMonth()+1);
if (monthCounter < 10)
  monthCounter = '0'+monthCounter;
var yearCounter = d.getFullYear();

var today = yearCounter+''+monthCounter+''+dayCounter;

var cal = document.getElementById('calendar');
var containerMonth = document.createElement('div');
var containerDays = document.createElement('div');
containerDays.setAttribute('id','daysGrid');
var containerDates = document.createElement('div');
containerDates.setAttribute('id','datesGrid');

buildHeader();
buildGrid(monthCounter,yearCounter);
buttons(); 

function buildHeader(){
  var monthX = document.createElement('div');
  monthX.setAttribute('class','month');
  var monthName = document.createElement('div');
  monthName.setAttribute('id','month');
  var buttonLeft = document.createElement('a');
  buttonLeft.setAttribute('id','buttonLeft');
  var buttonRight = document.createElement('a');
  buttonRight.setAttribute('id','buttonRight');
  monthX.appendChild(buttonLeft);
  monthX.appendChild(buttonRight);
  monthX.appendChild(monthName);
  containerMonth.appendChild(monthX);
  cal.appendChild(containerMonth);

  for (i=0; i<daysLabels.length; i++){
    var daysOfWeek = document.createElement('div');
    daysOfWeek.setAttribute('class','dayOfTheWeek');
    var day = document.createTextNode(daysLabels[i]);
    daysOfWeek.appendChild(day); 
    containerDays.appendChild(daysOfWeek);
    cal.appendChild(containerDays);
  }
}

function buildGrid(month, year){
  month=month*1;
  console.log(month+" "+year);
  document.getElementById('month').innerHTML = monthsLabels[monthCounter-1] + " " + yearCounter;
  var firstDay = new Date(year, month-1, 1);
           function daysInMonth(month,year) {
    return new Date(year, month, 0).getDate();
  }
  var x = firstDay.getDay();
  if (x == 0){
    for (i=0;i<6;i++){
      var days = document.createElement('div');
      days.setAttribute('class', 'days Ndays');
      containerDates.appendChild(days);
      cal.appendChild(containerDates);
    } 
  }
  while (x > 1){
    var days = document.createElement('div');
    days.setAttribute('class', 'days Ndays');
    containerDates.appendChild(days);
    cal.appendChild(containerDates);
    x--;
  }
  if (month < 10){ month ="0"+month; }
  for (i=1; i<=daysInMonth(month,year); i++){
    var days = document.createElement('div');
    if (i<10){i="0"+i;}
    days.setAttribute('id', year+''+month+''+i);
    days.setAttribute('class', 'days');
    var day = document.createTextNode(i);
    days.appendChild(day); 
    containerDates.appendChild(days);
    cal.appendChild(containerDates);
  }

  checkForEvents(); 
  addEvent();
}

function addEvent(){
  //jquery
  $(".days").on('click',function(){
    var id = $(this).attr('id');
    if (id === undefined){
      return;
    } else{
      console.log(id);
      $("#form").css('display','inline-block');
      document.getElementById('eventId').value = id;

    }
  });
}

function checkForEvents(){
  $.getJSON('events.json', function(data) {             
    for (i=0;i<data.examens.length;i++){
      $('#'+data.examens[i].date).addClass('examen');
      $('#'+data.examens[i].date).append('<p>'+ data.examens[i].title+'</p>');
      $('#'+data.examens[i].date).append('<p>'+ data.examens[i].hour+'</p>');
      $('#'+data.examens[i].date).append('<p>'+ data.examens[i].extra+'</p>');
    }
    for (i=0;i<data.events.length;i++){
      $('#'+data.events[i].date).addClass('event');
      $('#'+data.events[i].date).append('<p>'+ data.events[i].title+'</p>');
      $('#'+data.events[i].date).append('<p>'+ data.events[i].extra+'</p>');
    } 
    for (i=0;i<data.alerts.length;i++){
      $('#'+data.alerts[i].date).addClass('alertX');
      $('#'+data.alerts[i].date).append('<p>'+ data.alerts[i].title+'</p>');
      $('#'+data.alerts[i].date).append('<p>'+ data.alerts[i].extra+'</p>');
    }
  });
  $('#'+today).css('background-color','#272b33');
  $('#'+today).css('color','white');
  $('#datesGrid .days').each(function(){
    id=$(this).attr('id');
    if (id < today){
  $('#'+id).css('opacity','0.4');
    }
  });
  $('#datesGrid .Ndays').css('opacity','0.0');
  
}

function clean(){
  var container = document.getElementById('datesGrid');
  while (container.firstChild) { container.removeChild(container.firstChild); } 
}
function goToPreviousMonth(){ 
  clean();   
  monthCounter--;
  if(monthCounter < 1){
    monthCounter = 12;
    yearCounter--;
  }
  buildGrid(monthCounter, yearCounter);
}
function goToNextMonth(){ 
  clean();   
  monthCounter++;
  if (monthCounter > 12){
    monthCounter = 1;
    yearCounter++;
  }
  buildGrid(monthCounter, yearCounter);
}

function buttons(){
  $('#buttonLeft').on('click', goToPreviousMonth );

  $('#buttonRight').on('click', goToNextMonth );
}  

document.addEventListener("keydown", keyDownTextField, false);
function keyDownTextField(e) {
  var keyCode = e.keyCode;
  if(keyCode==37) {    
    goToPreviousMonth();
  } else if(keyCode==39){
    goToNextMonth();
  }
}
$("#calendar").on("swipeleft",function(){
  goToNextMonth();
});
$("#calendar").on("swiperight",function(){
  goToPreviousMonth();
});
$(document).ready(function() { 
  $('#eventform').submit(function(e) {
    var id = $('#eventId').val()
    var title = $('#eventTitle').val()
    var extra = $('#eventExtra').val()
    var url='calendar.php?id='+id+'?title='+title+'?extra='+extra
    console.log(url);
    $('#form').fadeOut(500);
    $.ajax({
      method:'POST',
      url:'calendar.php?id='+id+'?title='+title+'?extra='+extra,
      data:{

      },
      datatype:'json',
      success:function(){
        console.log('succes'); 
        clean();
        buildGrid(monthCounter, yearCounter);
      }
    });
    e.preventDefault();
    $(this).get(0).reset();
  });
});</script></html>